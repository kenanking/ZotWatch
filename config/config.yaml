# ZotWatch Configuration

zotero:
  mode: "api"
  api:
    user_id: "${ZOTERO_USER_ID}"
    api_key: "${ZOTERO_API_KEY}"
    page_size: 100
    polite_delay_ms: 200

sources:
  arxiv:
    enabled: true
    categories:
      - "cs.LG"   # Machine Learning
      - "cs.CV"   # Computer Vision and Pattern Recognition
      - "cs.AI"   # Artificial Intelligence
      - "stat.ML" # Machine Learning (Statistics)
    days_back: 4
    max_results: 3000
  crossref:
    enabled: true
    mailto: "${CROSSREF_MAILTO}"
    days_back: 2
    max_results: 3000
  # Abstract scraper (Camoufox + rule-based + LLM fallback)
  scraper:
    enabled: true
    rate_limit_delay: 1.0
    timeout: 60000
    max_retries: 2
    max_html_chars: 15000
    llm_max_tokens: 1024
    llm_temperature: 0.1
    use_llm_fallback: true

scoring:
  # Threshold configuration: controls how papers are labeled (must_read/consider/ignore)
  thresholds:
    mode: "dynamic"  # "fixed" (static thresholds) or "dynamic" (percentile-based)
    must_read: 0.75  # Fixed mode: must_read threshold
    consider: 0.55   # Fixed mode: consider threshold
    dynamic:         # Dynamic mode: percentile-based thresholds
      must_read_percentile: 95  # Top 5% as must_read
      consider_percentile: 70   # 70th-95th percentile as consider
      min_must_read: 0.60       # Minimum score floor for must_read
      min_consider: 0.40        # Minimum score floor for consider

  # User research interests for interest-based recommendations (optional)
  interests:
    enabled: true
    description: |
      æˆ‘ç°åœ¨é‡ç‚¹å…³æ³¨ä¸‹é¢çš„ç ”ç©¶æ–¹å‘ï¼š
      1) å›½åœŸèµ„æºç®¡ç†é¢†åŸŸçš„åœŸåœ°åˆ©ç”¨åˆ†ç±»ã€åœ°è¡¨è¦†ç›–åˆ†ç±»ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€çš„å›¾åƒåˆ†ç±»
      2) è¡—æ™¯æ•°æ®åˆ†æï¼Œæ¯”å¦‚ï¼šè¡—æ™¯åœºæ™¯ç†è§£ã€åˆ†ç±»
      3) å¤šå®ä¾‹å­¦ä¹ ç›¸å…³é¢†åŸŸ
      4) è§†è§‰åŸºç¡€æ¨¡å‹é¢„è®­ç»ƒï¼ˆä¾‹å¦‚ï¼šCLIPã€MAEã€DINOã€JEPA ç­‰ç›¸å…³æ–¹æ³•ï¼‰
      5) å¤§è¯­è¨€æ¨¡å‹çš„æœ€æ–°è¿›å±•
      6) å¸Œæœ›æ’é™¤ç”Ÿç‰©åŒ»å­¦é¢†åŸŸçš„ç ”ç©¶
    max_documents: 500  # Max documents for FAISS recall (Voyage limit: 1000, DashScope: 500)
    top_k_interest: 5  # Final interest-based papers count

  # Rerank settings (only used when interests.enabled=true)
  # Provider MUST match embedding.provider when interests are enabled
  rerank:
    provider: "voyage"  # Options: "voyage" or "dashscope"
    model: "rerank-2.5"  # voyage: rerank-2/rerank-2.5, dashscope: qwen3-rerank

# Embedding configuration (provider MUST match rerank.provider when interests are enabled)
embedding:
  provider: "voyage"  # Options: "voyage" or "dashscope"
  model: "voyage-3.5"  # voyage: voyage-3.5, dashscope: text-embedding-v3
  api_key: "${VOYAGE_API_KEY}"  # voyage: VOYAGE_API_KEY, dashscope: DASHSCOPE_API_KEY
  batch_size: 128  # For DashScope models, must be <=10

# LLM configuration for AI summaries and translation
llm:
  enabled: true
  provider: "kimi"  # Options: "kimi", "openrouter", or "deepseek"
  api_key: "${MOONSHOT_API_KEY}"  # kimi: MOONSHOT_API_KEY
  model: "kimi-k2-turbo-preview"
  max_tokens: 5120
  temperature: 0.3
  retry:
    max_attempts: 3
    backoff_factor: 2.0
    initial_delay: 1.0
  summarize:
    top_n: 20
    cache_expiry_days: 30
  translation:
    enabled: true  # Translate English titles to Chinese

# Output Configuration
output:
  timezone: "Asia/Shanghai"  # IANA timezone name (e.g., "UTC", "America/New_York")
  rss:
    title: "ZotWatch Feed"
    link: "https://ehehe.cn/zotwatch/"
    description: "AI-assisted literature watch"
  html:
    template: "report.html"
    include_summaries: true

# Profile analysis configuration
profile:
  exclude_tags:  # Drop these tags during Zotero ingest (personal markers)
    - "â³"
    - "âœ”ï¸"
    - "ğŸ’"
    - "/done"
    - "/reading"
    - "/unread"
    - "â­"
    - "â­â­"
    - "â­â­â­"
    - "â­â­â­â­"
    - "â­â­â­â­â­"
  author_min_count: 10  # Minimum appearances for "frequent author"
  # Clustering configuration for semantic grouping of research papers
  # Uses adaptive Silhouette-based clustering with automatic k selection
  clustering:
    enabled: true
    max_clusters: 35               # Upper limit on cluster count
    min_cluster_size: 1            # Minimum papers per valid cluster (1 = allow single-paper clusters)
    biased_k_tolerance_percent: 0.10  # Within 10% of best Silhouette score, select the largest k
    generate_labels: true          # Use LLM to generate cluster labels
    # Temporal weighting for time-decay of paper relevance
    temporal:
      enabled: true
      halflife_days: 180           # Papers half as relevant after 6 months
      min_weight: 0.05             # Floor weight for very old papers

# Watch pipeline configuration
watch:
  recent_days: 7          # Filter papers older than N days
  max_preprint_ratio: 0.9 # Max preprint ratio in results
  top_k: 20               # Default recommendation count
  require_abstract: true  # Filter out papers without abstracts
