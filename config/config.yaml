# ZotWatch Configuration

zotero:
  mode: "api"
  api:
    user_id: "${ZOTERO_USER_ID}"
    api_key: "${ZOTERO_API_KEY}"
    page_size: 100
    polite_delay_ms: 200

sources:
  arxiv:
    enabled: true
    categories:
      - "cs.LG"   # Machine Learning
      - "cs.CV"   # Computer Vision and Pattern Recognition
      - "cs.AI"   # Artificial Intelligence
      - "stat.ML" # Machine Learning (Statistics)
    days_back: 4
    max_results: 3000
  crossref:
    enabled: true
    mailto: "${CROSSREF_MAILTO}"
    days_back: 1
    max_results: 3000
  # Abstract scraper for enriching missing abstracts (Camoufox + rule-based + LLM fallback)
  scraper:
    enabled: true
    rate_limit_delay: 1.0  # Seconds between requests
    timeout: 60000  # Page load timeout (ms)
    max_retries: 2  # Retry attempts per URL
    max_html_chars: 15000  # Max HTML chars to send to LLM
    llm_max_tokens: 1024  # Max tokens for LLM extraction response
    llm_temperature: 0.1  # Low temperature for accurate extraction
    use_llm_fallback: true  # Use LLM when rule extraction fails

scoring:
  # Threshold Configuration
  # Controls how papers are labeled: "must_read", "consider", or "ignore"
  thresholds:
    # Mode: "fixed" uses static thresholds below; "dynamic" computes from score distribution
    # Dynamic mode helps when absolute scores vary across runs, ensuring consistent relative ranking
    mode: "dynamic"

    # Fixed thresholds (used when mode: "fixed")
    # Papers with score >= must_read are labeled "must_read"
    # Papers with score >= consider (but < must_read) are labeled "consider"
    must_read: 0.75
    consider: 0.55

    # Dynamic thresholds (used when mode: "dynamic")
    # Computes thresholds based on percentiles of the current batch's score distribution
    dynamic:
      must_read_percentile: 95  # Top 5% are must_read (95th percentile = top 5%)
      consider_percentile: 70   # 70th-95th percentile are consider
      min_must_read: 0.60       # Floor: never label as must_read if score < this
      min_consider: 0.40        # Floor: never label as consider if score < this

  # User research interests for interest-based recommendations (optional)
  interests:
    enabled: true
    description: |
      ÊàëÁé∞Âú®ÈáçÁÇπÂÖ≥Ê≥®‰∏ãÈù¢ÁöÑÁ†îÁ©∂ÊñπÂêëÔºö
      1) SAR ÂõæÂÉèÁõÆÊ†áËØÜÂà´„ÄÅÊ£ÄÊµã„ÄÅË∑üË∏™ÔºåÂ∞§ÂÖ∂ÈíàÂØπËà∞ËàπÁõÆÊ†á
      2) Â§öÊ∫ê‰º†ÊÑüÂô®ËûçÂêàÔºåÂ∞§ÂÖ∂ÊòØ SAR ‰∏éÁ∫¢Â§ñÁöÑËûçÂêà
      3) ËßÜËßâÂü∫Á°ÄÊ®°ÂûãÈ¢ÑËÆ≠ÁªÉÔºà‰æãÂ¶ÇÔºöCLIP„ÄÅMAE„ÄÅDINO„ÄÅJEPA Á≠âÁõ∏ÂÖ≥ÊñπÊ≥ïÔºâ
      4) Â§ßËØ≠Ë®ÄÊ®°ÂûãÁöÑÊúÄÊñ∞ËøõÂ±ï
      5) Â∏åÊúõÊéíÈô§ÁîüÁâ©ÂåªÂ≠¶È¢ÜÂüüÁöÑÁ†îÁ©∂
    top_k_recall: -1  # FAISS recall count, -1 to skip FAISS and use all candidates
    top_k_interest: 5  # Final interest-based papers count

  # Voyage Rerank settings (uses VOYAGE_API_KEY)
  rerank:
    enabled: true
    model: "rerank-2.5"

embedding:
  provider: "voyage"
  model: "voyage-3.5"
  api_key: "${VOYAGE_API_KEY}"
  input_type: "document"
  batch_size: 128

# LLM Configuration for AI summaries
# Supported providers: "openrouter", "kimi"
llm:
  enabled: true
  provider: "kimi"
  api_key: "${MOONSHOT_API_KEY}"
  model: "kimi-k2-turbo-preview"
  max_tokens: 5120
  temperature: 0.3
  retry:
    max_attempts: 3
    backoff_factor: 2.0
    initial_delay: 1.0
  summarize:
    top_n: 20
    cache_expiry_days: 30
  # Title translation (translate English titles to Chinese in HTML report)
  translation:
    enabled: true

# Example Kimi configuration (uncomment to use):
# llm:
#   enabled: true
#   provider: "kimi"
#   api_key: "${MOONSHOT_API_KEY}"
#   model: "kimi-k2-thinking-turbo"  # or "kimi-k2-turbo-preview"
#   max_tokens: 16000  # Thinking models need >=16000
#   temperature: 1.0   # Thinking models recommend 1.0, normal models 0.6

# Output Configuration
output:
  timezone: "Asia/Shanghai"  # IANA timezone name (e.g., "UTC", "America/New_York")
  rss:
    title: "ZotWatch Feed"
    link: "https://ehehe.cn/zotwatch/"
    description: "AI-assisted literature watch"
  html:
    template: "report.html"
    include_summaries: true

# Profile Analysis Configuration
profile:
  # Keywords/tags to exclude from statistics (e.g., personal markers)
  exclude_keywords:
    - "‚è≥"
    - "‚úîÔ∏è"
    - "üíé"
    - "/done"
    - "/reading"
    - "/unread"
  # Minimum author appearance threshold for "frequent author" count
  author_min_count: 10

# Watch Pipeline Configuration
# Controls behavior of `zotwatch watch` command
watch:
  recent_days: 7          # Filter papers older than this many days
  max_preprint_ratio: 0.9 # Maximum ratio of preprints (arXiv/bioRxiv/medRxiv) in results
  top_k: 20               # Default number of recommendations (can be overridden with --top)
  require_abstract: true  # Filter out candidates without abstracts (required for similarity scoring)
